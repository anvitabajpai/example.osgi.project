<?xml version="1.0" encoding="UTF-8" ?>
<config>
	<abortOnConfigurationError>${solr.abortOnConfigurationError:false}</abortOnConfigurationError>

	<luceneMatchVersion>LUCENE_CURRENT</luceneMatchVersion>

	<indexDefaults>
		<useCompoundFile>false</useCompoundFile>
		<mergeFactor>10</mergeFactor>
		<ramBufferSizeMB>32</ramBufferSizeMB>
		<maxFieldLength>10000</maxFieldLength>
		<writeLockTimeout>1000</writeLockTimeout>
		<commitLockTimeout>10000</commitLockTimeout>
		<lockType>simple</lockType>
	</indexDefaults>

	<mainIndex>
		<useCompoundFile>false</useCompoundFile>
		<ramBufferSizeMB>32</ramBufferSizeMB>
		<mergeFactor>10</mergeFactor>
		<unlockOnStartup>false</unlockOnStartup>
		<reopenReaders>true</reopenReaders>

		<deletionPolicy class="solr.SolrDeletionPolicy">
			<str name="maxCommitsToKeep">1</str>
			<str name="maxOptimizedCommitsToKeep">0</str>
		</deletionPolicy>
		<infoStream file="INFOSTREAM.txt">false</infoStream>
	</mainIndex>

	<updateHandler class="solr.DirectUpdateHandler2">
		<autoCommit>
			<maxDocs>100</maxDocs>
			<maxTime>10000</maxTime>
		</autoCommit>
	</updateHandler>

	<query>
		<maxBooleanClauses>1024</maxBooleanClauses>

		<filterCache class="org.apache.solr.search.FastLRUCache" size="512" initialSize="512" autowarmCount="0" />
		<queryResultCache class="solr.LRUCache" size="512" initialSize="512" autowarmCount="0" />
		<documentCache class="solr.LRUCache" size="512" initialSize="512" autowarmCount="0" />

		<enableLazyFieldLoading>true</enableLazyFieldLoading>
		<queryResultWindowSize>20</queryResultWindowSize>
		<queryResultMaxDocsCached>200</queryResultMaxDocsCached>

		<listener event="newSearcher" class="solr.QuerySenderListener">
			<arr name="queries">
			</arr>
		</listener>

		<listener event="firstSearcher" class="solr.QuerySenderListener">
			<arr name="queries">
				<lst>
					<str name="q">solr rocks</str>
					<str name="start">0</str>
					<str name="rows">10</str>
				</lst>
				<lst>
					<str name="q">static firstSearcher warming query from solrconfig.xml</str>
				</lst>
			</arr>
		</listener>

		<useColdSearcher>false</useColdSearcher>
		<maxWarmingSearchers>2</maxWarmingSearchers>
	</query>

	<requestDispatcher handleSelect="true">
		<requestParsers enableRemoteStreaming="true" multipartUploadLimitInKB="2048000" />
		<httpCaching lastModifiedFrom="openTime" etagSeed="Solr"></httpCaching>
	</requestDispatcher>
 
	<requestHandler name="default" class="solr.SearchHandler" default="true">
		<lst name="defaults">
			<str name="fl">*,score</str>
		</lst>
		<lst name="invariants">
			<str name="echoParams">explicit</str>

			<str name="request.enricher.type">pipe-and-filter</str>
			<str name="request.enricher.expression">${request.enricher.expression}</str>
			<str name="response.enricher.type">pipe-and-filter</str>
			<str name="response.enricher.expression">${response.enricher.expression}</str>
		</lst>
		<lst name="appends">
		</lst>

		<arr name="first-components">
			<str>requestEnricher</str>
		</arr>
		<arr name="last-components">
			<str>responseEnricher</str>
		</arr>
	</requestHandler>
 
	<requestHandler name="/update" class="solr.XmlUpdateRequestHandler" />
 
	<searchComponent name="requestEnricher" class="org.amdatu.search.enricher.request.RequestEnricherSearchComponent" />
	<searchComponent name="responseEnricher" class="org.amdatu.search.enricher.response.ResponseEnricherSearchComponent" />
	
	<searchComponent name="highlight" class="solr.HighlightComponent">
		<highlighting>
			<fragmenter name="gap" class="org.apache.solr.highlight.GapFragmenter" default="true">
				<lst name="defaults">
					<int name="hl.fragsize">100</int>
				</lst>
			</fragmenter>
	
			<fragmenter name="regex" class="org.apache.solr.highlight.RegexFragmenter">
				<lst name="defaults">
					<int name="hl.fragsize">70</int>
					<float name="hl.regex.slop">0.5</float>
					<str name="hl.regex.pattern">[-\w ,/\n\"']{20,200}</str>
				</lst>
			</fragmenter>
	
			<formatter name="html" class="org.apache.solr.highlight.HtmlFormatter" default="true">
				<lst name="defaults">
					<str name="hl.simple.pre"><![CDATA[<em>]]></str>
					<str name="hl.simple.post"><![CDATA[</em>]]></str>
				</lst>
			</formatter>
		</highlighting>
	</searchComponent>
	
</config>